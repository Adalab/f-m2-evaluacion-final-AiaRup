"use strict";const searchButton=document.querySelector(".form__button"),searchInput=document.querySelector(".form__input"),seriesList=document.querySelector(".series"),favoritiesList=document.querySelector(".series__favorities"),errorContainer=document.querySelector(".error");let favoriteSeries=[];const changeSeriesArray=(e,t)=>{const a=favoriteSeries.filter(e=>e.id===parseInt(t));a.length?favoriteSeries.splice(favoriteSeries.indexOf(a),1):favoriteSeries.push(e),saveStorageData(favoriteSeries),paintFavorities(favoriteSeries)},showObject=(e,t,a)=>({name:e,image:t,id:a});function saveStorageData(e){localStorage.setItem("favoriteShows",JSON.stringify(e))}function getStorageData(e){return JSON.parse(localStorage.getItem(e))}function removeStorageData(e){localStorage.removeItem(e)}function showOnClick(e,t){const{currentTarget:a}=e;a.classList.toggle("favorite");const i=a.dataset.id;changeSeriesArray(t,i)}function deleteFavorite(e){const t=favoriteSeries.findIndex(t=>t.id===parseInt(e));console.log("index",t),favoriteSeries.splice(t,1),paintFavorities(favoriteSeries),removeStorageData("favoriteShows"),saveStorageData(favoriteSeries)}const fetchOnEnter=e=>{13===e.keyCode&&searchSeries(apiUrl)};window.addEventListener("keyup",fetchOnEnter);const apiUrl="http://api.tvmaze.com/search/shows?q=",defaultImage="https://via.placeholder.com/210x295/ffffff/666666/?text=TV",takeUserInput=()=>{const e={text:searchInput.value,status:!0};return e.text?errorContainer.classList.add("hidden"):(e.status=!1,errorContainer.classList.remove("hidden")),e},checkImage=e=>e?e.medium:defaultImage,showSeries=({show:e})=>{let{image:t,name:a,id:i}=e;t=checkImage(t);const s=document.createElement("li");s.classList.add("show"),s.setAttribute("data-id",i);const r=favoriteSeries.findIndex(e=>e.id===i);console.log("index of show",r),console.log("id",i),-1!==r&&s.classList.add("favorite");const o=document.createElement("div"),n=document.createElement("img");o.classList.add("show__image"),n.setAttribute("alt",a),n.setAttribute("src",t),n.classList.add("show__image-fake"),o.setAttribute("style",`background-image:url('${t}')`);const c=document.createElement("h2");c.classList.add("show__title");const d=document.createTextNode(a);c.appendChild(d),s.appendChild(c),s.appendChild(o);const l=showObject(a,t,i);s.addEventListener("click",e=>{showOnClick(e,l)}),seriesList.appendChild(s)};function searchSeries(e){const t=takeUserInput();t.status&&fetch(`${e}${t.text}`).then(e=>e.json()).then(e=>{seriesList.innerHTML="";for(const t of e)showSeries(t)}).catch(e=>console.log("error",e))}function paintFavorities(e){favoritiesList.innerHTML="";for(const t of e){const{id:e,image:a,name:i}=t,s=document.createElement("li");s.classList.add("show__favorite"),s.setAttribute("data-id",e);const r=document.createElement("div"),o=document.createElement("img");r.classList.add("favorite__image"),o.setAttribute("alt",i),o.setAttribute("src",a),o.classList.add("favorite__image-fake"),r.setAttribute("style",`background-image:url('${a}')`);const n=document.createElement("h2");n.classList.add("favorite__title");const c=document.createTextNode(i);n.appendChild(c);const d=document.createElement("div");d.classList.add("favorite__delete-icon");const l=document.createTextNode("x");d.appendChild(l),d.addEventListener("click",()=>{deleteFavorite(e)}),s.appendChild(n),s.appendChild(r),s.appendChild(d),favoritiesList.appendChild(s)}}searchButton.addEventListener("click",()=>{searchSeries(apiUrl)});const loadFavorites=()=>{favoriteSeries=[];const e=getStorageData("favoriteShows");e&&(favoriteSeries=e,paintFavorities(e))};loadFavorites();